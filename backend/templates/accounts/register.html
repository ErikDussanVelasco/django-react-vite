{% extends "accounts/base.html" %}

{% block title %}Registro - Mi Tienda{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center">
    <div class="w-full max-w-lg bg-white rounded-xl shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-4 text-center">Crea tu cuenta</h2>

        <form id="registerForm" method="POST" class="space-y-4">
            {% csrf_token %}

            <div>
                <label for="email" class="block font-semibold text-gray-700 mb-1">Correo electrónico</label>
                <input id="email" name="email" type="email" required autofocus
                             class="w-full border rounded px-4 py-2 focus:ring-2 focus:ring-blue-400">
            </div>

            <div>
                <label for="username" class="block font-semibold text-gray-700 mb-1">Usuario</label>
                <input id="username" name="username" type="text" required
                             class="w-full border rounded px-4 py-2 focus:ring-2 focus:ring-blue-400" placeholder="nombre_usuario">
            </div>

            <div>
                <label for="password" class="block font-semibold text-gray-700 mb-1">Contraseña</label>
                <div class="relative">
                    <input id="password" name="password" type="password" required minlength="6"
                                 class="w-full border rounded px-4 py-2 pr-28 focus:ring-2 focus:ring-blue-400" placeholder="••••••••">
                    <button type="button" id="togglePwd" class="absolute right-2 top-2 bg-gray-100 px-3 py-1 rounded text-sm">Mostrar</button>
                </div>
                <div class="mt-2">
                    <div id="pwdStrength" class="h-2 bg-gray-200 rounded overflow-hidden">
                        <div id="pwdBar" class="h-2 bg-red-500 w-0"></div>
                    </div>
                    <p id="pwdText" class="text-sm text-gray-600 mt-1">Mínimo 6 caracteres</p>
                </div>
            </div>

            <div>
                <label for="password_confirm" class="block font-semibold text-gray-700 mb-1">Confirmar contraseña</label>
                <input id="password_confirm" name="password_confirm" type="password" required minlength="6"
                             class="w-full border rounded px-4 py-2 focus:ring-2 focus:ring-blue-400" placeholder="••••••••">
            </div>

            <div class="flex items-center justify-between">
                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Crear cuenta</button>
                <a href="{% url 'login' %}" class="text-sm text-gray-600 hover:underline">¿Ya tienes cuenta? Inicia sesión</a>
            </div>
        </form>
    </div>
</div>

<script>
    (function(){
        const pwd = document.getElementById('password');
        const pwdConfirm = document.getElementById('password_confirm');
        const pwdBar = document.getElementById('pwdBar');
        const pwdText = document.getElementById('pwdText');
        const toggle = document.getElementById('togglePwd');
        const form = document.getElementById('registerForm');

        function strength(value){
            let score = 0;
            if(!value) return 0;
            if (value.length >= 6) score += 1;
            if (/[A-Z]/.test(value)) score += 1;
            if (/[0-9]/.test(value)) score += 1;
            if (/[^A-Za-z0-9]/.test(value)) score += 1;
            return score;
        }

        function updateStrength(){
            const s = strength(pwd.value);
            const width = (s/4)*100;
            pwdBar.style.width = width + '%';
            if(s <= 1){ pwdBar.className = 'h-2 bg-red-500 w-0'; pwdText.textContent = 'Muy débil'; }
            else if(s == 2){ pwdBar.className = 'h-2 bg-yellow-400'; pwdText.textContent = 'Débil'; }
            else if(s == 3){ pwdBar.className = 'h-2 bg-blue-400'; pwdText.textContent = 'Buena'; }
            else { pwdBar.className = 'h-2 bg-green-500'; pwdText.textContent = 'Fuerte'; }
        }

        pwd.addEventListener('input', updateStrength);
        toggle.addEventListener('click', function(){
            if(pwd.type === 'password'){ pwd.type = 'text'; this.textContent = 'Ocultar'; }
            else { pwd.type = 'password'; this.textContent = 'Mostrar'; }
        });

        form.addEventListener('submit', function(e){
            if(pwd.value !== pwdConfirm.value){
                e.preventDefault();
                alert('Las contraseñas no coinciden');
                pwdConfirm.focus();
            }
        });
    })();
</script>

{% endblock %}
