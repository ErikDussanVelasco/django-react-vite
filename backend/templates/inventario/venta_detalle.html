{% extends "inventario/base.html" %}
{% load currency_filter %}
{% block title %}Venta {{ venta.id }}{% endblock %}
{% block page_title %}Venta #{{ venta.id }}{% endblock %}

{% block content %}

<div class="bg-white p-6 rounded-xl shadow max-w-2xl mx-auto">

    <p class="text-gray-600 mb-4">Fecha: {{ venta.fecha }}</p>

    <p class="text-gray-600 mb-2">MÃ©todo de pago: <strong>{{ venta.metodo_pago }}</strong></p>
    <p class="text-gray-600 mb-2">Monto recibido: ${{ venta.monto_recibido|currency_format }}</p>
    <p class="text-gray-600 mb-4">Cambio: ${{ venta.cambio|currency_format }}</p>

    <table class="w-full">
        <thead class="bg-gray-100 border-b">
            <tr>
                <th class="px-3 py-2">Producto</th>
                <th class="px-3 py-2">Cantidad</th>
                <th class="px-3 py-2">Precio</th>
                <th class="px-3 py-2">Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in venta.detalles.all %}
            <tr class="border-b">
                <td class="px-3 py-2">{{ item.producto.nombre }}</td>
                <td class="px-3 py-2">{{ item.cantidad }}</td>
                <td class="px-3 py-2">${{ item.precio_unitario|currency_format }}</td>
                <td class="px-3 py-2">${{ item.subtotal|currency_format }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="mt-6 text-right">

        <p>Total bruto: ${{ venta.total|currency_format }}</p>

        <p>Descuento: <span class="text-red-600">-${{ venta.descuento_general|currency_format }}</span></p>

        <p>IVA ({{ venta.iva_porcentaje }}%): ${{ venta.iva_total|currency_format }}</p>

        <hr class="my-2">

        <h2 class="text-2xl font-bold">TOTAL FINAL: ${{ venta.total_final|currency_format }}</h2>
    </div>

    <div class="text-right mt-4 space-x-2">
        <!-- BotÃ³n para descargar factura -->
        <a href="{% url 'venta_factura_pdf' venta.id %}"
           class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
            ðŸ§¾ Descargar Factura
        </a>

        <!-- BotÃ³n para generar link de pago Mercado Pago -->
        {% if venta.estado_pago == "pendiente" %}
        <a href="{% url 'generar_link_pago' venta.id %}"
           class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            ðŸ’³ Generar Link de Pago
        </a>
        {% endif %}
    </div>

</div>

{% endblock %}
